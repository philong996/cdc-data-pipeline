# Debezium Server configuration

# Sink configuration - Google Cloud Pub/Sub
debezium.sink.type=pubsub
debezium.sink.pubsub.project.id=quickstart-1565940213534


# Optional: Specify ordering key (for maintaining order)
debezium.sink.pubsub.ordering.enabled=true

# Address for monitoring/health checks
debezium.http.port=8080

# Source configuration - PostgreSQL
debezium.source.connector.class=io.debezium.connector.postgresql.PostgresConnector
debezium.source.offset.storage.file.filename=data/offsets.dat
debezium.source.offset.flush.interval.ms=60000

# PostgreSQL connection settings
debezium.source.database.hostname=localhost
debezium.source.database.port=5432
debezium.source.database.user=debezium_user
debezium.source.database.password=debezium_user
debezium.source.database.dbname=postgres
debezium.source.database.server.name=postgres-server

# Topic prefix for Pub/Sub topics
debezium.source.topic.prefix=cdc-pipeline

# Tables to capture
debezium.source.table.include.list=public.products
# Or use schema.include.list for all tables in a schema
# debezium.source.schema.include.list=public

# PostgreSQL plugin (use pgoutput for PostgreSQL 10+)
debezium.source.plugin.name=pgoutput

# Replication slot configuration
debezium.source.slot.name=debezium_slot
debezium.source.publication.name=dbz_publication
debezium.source.publication.autocreate.mode=all_tables

# Schema change tracking
debezium.source.schema.history.internal=io.debezium.relational.history.FileDatabaseHistory
debezium.source.schema.history.internal.file.filename=data/schema-history.dat

# Snapshot mode
debezium.source.snapshot.mode=initial

# Heartbeat to prevent replication slot timeout
# debezium.source.heartbeat.interval.ms=10000
# debezium.source.heartbeat.topics.prefix=__debezium-heartbeat

# Enable tombstones but transform them into full messages
debezium.source.tombstones.on.delete=true

# Add transformation to handle deletes
debezium.transforms=unwrap
debezium.transforms.unwrap.type=io.debezium.transforms.ExtractNewRecordState
debezium.transforms.unwrap.drop.tombstones=false
debezium.transforms.unwrap.delete.handling.mode=rewrite
debezium.transforms.unwrap.add.fields=op,source.ts_ms,source.table

# Add headers to identify operation type
debezium.transforms.unwrap.add.headers=op


# Logging
quarkus.log.console.enable=false
quarkus.log.file.enable=true
quarkus.log.file.path=logs/debezium-server.log
quarkus.log.file.level=INFO
quarkus.log.file.format=%d{HH:mm:ss} %-5p %s%e%n
quarkus.log.file.rotation.max-file-size=10M
quarkus.log.file.rotation.max-backup-index=5
quarkus.log.file.rotation.file-suffix=.yyyy-MM-dd

